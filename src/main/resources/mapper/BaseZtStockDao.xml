<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.example.springBootDemo.dao.mapper.BaseZtStockDao">
    <resultMap id="BaseResultMap" type="com.example.springBootDemo.entity.BaseZtStock">
        <id column="id" jdbcType="INTEGER" property="id"/>
        <result column="stock_code" jdbcType="CHAR" property="stockCode"/>
        <result column="stock_name" jdbcType="CHAR" property="stockName"/>
        <result column="plate" jdbcType="CHAR" property="plate"/>
        <result column="Main_business" jdbcType="CHAR" property="mainBusiness"/>
        <result column="Niche_business" jdbcType="CHAR" property="nicheBusiness"/>
        <result column="instructions" jdbcType="CHAR" property="instructions"/>
        <result column="combo" jdbcType="INTEGER" property="combo"/>
        <result column="harden_time" jdbcType="TIME" property="hardenTime"/>
        <result column="final_Harden_time" jdbcType="TIME" property="finalHardenTime"/>
        <result column="harden_type" jdbcType="CHAR" property="hardenType"/>
        <result column="reason" jdbcType="CHAR" property="reason"/>
        <result column="gains" jdbcType="REAL" property="gains"/>
        <result column="yesterday_gains" jdbcType="REAL" property="yesterdayGains"/>
        <result column="amplitude" jdbcType="REAL" property="amplitude"/>
        <result column="yesterday_amplitude" jdbcType="REAL" property="yesterdayAmplitude"/>
        <result column="changing_hands" jdbcType="REAL" property="changingHands"/>
        <result column="yesterday_changing_hands" jdbcType="REAL" property="yesterdayChangingHands"/>
        <result column="create_date" jdbcType="DATE" property="createDate"/>
        <result column="create_by" jdbcType="CHAR" property="createBy"/>
        <result column="modifed_date" jdbcType="DATE" property="modifedDate"/>
        <result column="modifed_by" jdbcType="CHAR" property="modifedBy"/>
        <result column="remark" jdbcType="CHAR" property="remark"/>
        <result column="circulation" jdbcType="INTEGER" property="circulation"/>
        <result column="entity_size" jdbcType="INTEGER" property="entitySize"/>
        <result column="yesteday_entity_size" jdbcType="INTEGER" property="yestedayEntitySize"/>
    </resultMap>

    <select id="getZtReportByDate" resultType="com.example.springBootDemo.entity.report.ZtReport"
            parameterType="java.lang.String">
        select
          zt.*,
          1 source,
          zb.entity_Size yestedayEntitySize,
          b.bond_full_name bond,b.instructions bondInstructions,
           CASE WHEN cs.stock_code is not null THEN '次新;'
                 ELSE  ''
                  END AS cxFlag
        from base_zt_stock zt
        left join base_zb_stock zb on zt.stock_code = zb.stock_code and  zb.create_date = zt.create_date-1
        LEFT JOIN base_bond b on b.stk_short_name = zt.stock_name
        LEFT JOIN conf_cx_stock cs on cs.stock_code = zt.stock_code
        where zt.create_date = #{date}
    </select>

</mapper>